
ocl(expr) ::= <<
<({<expr.kind>_expr})(expr)>
>>

query_expr(query) ::= <<
<if(query.transform.suffix)><\\>
<({<query.transform.suffix>_suffix})(transform_expr(query))><\\>
<else><\\>
<transform_expr(query)><\\>
<endif>
>>

transform_expr(query) ::= <<
<({<query.transform.operation>_expr})(ocl(query.base), query.transform)>
>>

select_expr(base_expr, transform) ::= <<
<collection_call("select", base_expr, transform)>
>>

reject_expr(base_expr, transform) ::= <<
<collection_call("reject", base_expr, transform)>
>>

yield_expr(base_expr, transform) ::= <<
<flatten_call(collection_call("collect", base_expr, transform))>
>>

flatten_call(expr) ::= <<
(<expr> -> flatten())
>>

collection_call(name, base_expr, transform) ::= <<
(<base_expr> -> <name>(<ocl(transform.expr)>))
>>

unique_suffix(body) ::= <<
(<body> -> asSet())
>>

path_expr(path) ::= <<
<path.names; separator=".">
>>

unary_expr(unary) ::= <<
(<expr_operator(unary)> <ocl(unary.expr)>)
>>

infix_expr(infix) ::= <<
(<ocl(infix.left)> <expr_operator(infix)> <ocl(infix.right)>)
>>

expr_operator(expr) ::= <<
<if(expr.operation)><\\>
<({operator_<expr.operation>})()><\\>
<else><\\>
<expr.operator><\\>
<endif>
>>

operator_add() ::= "+"
operator_sub() ::= "-"
operator_mul() ::= "*"
operator_div() ::= "/"
operator_mod() ::= "%"
operator_exp() ::= "^"

operator_eq() ::= "="
operator_ineq() ::= "\<>"
operator_gt() ::= ">"
operator_gte() ::= ">="
operator_lt() ::= "\<"
operator_lte() ::= "\<="

operator_and() ::= "and"
operator_or() ::= "or"
operator_xor() ::= "xor"
operator_implies() ::= "implies"
operator_not() ::= "not"

conditional_expr(conditional) ::= <<
(if <ocl(conditional.cond)> then <ocl(conditional.then)> else <ocl(conditional.else_)> endif)
>>

literal_expr(literal) ::= <<
<({literal_expr_<literal.type.name>})(literal.text)>
>>

literal_expr_Boolean(text) ::= <<
<text>
>>

literal_expr_String(text) ::= <<
"<text>"
>>

literal_expr_Integer(text) ::= <<
<text>
>>

literal_expr_Decimal(text) ::= <<
<text>
>>